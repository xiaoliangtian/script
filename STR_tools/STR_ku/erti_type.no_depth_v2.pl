#! /usr/bin/perl #-w
#use strict;
use Getopt::Long;
##############usage##############################
die "Usage:
    perl [script] -i [input_vcf] -o [output_file] -m [mother_column] -s [son_column] -f [father_column] -d [min_var_depth]

        -i  input: str txt or vcf file
        -o  output
        -m  mother_data_column"
  unless @ARGV >= 1;

########################

my $in;
my $out;
my $mom;
my $son;
my $dad;
my $min;
my $ref;
my $rate;
Getopt::Long::GetOptions(
    'i=s' => \$in,
    'o=s' => \$out,
    'm:i' => \$mom,
    's:i' => \$son,
    "f:i" => \$dad,
    "d:i" => \$min,
    "r:f" => \$rate,

);

open IN, "<$in"
  or die "Cannot open file $in!\n";
open OUT, ">$out"
  or die "Cannot open file $out!\n";
my %len = (
    "D1S1646"        => "D1S1646",
    "D1GATA113"      => "D1GATA113",
    "D1S552"         => "D1S552",
    "D1S1598"        => "D1S1598",
    "D1S2134"        => "D1S2134",
    "D1S3734"        => "D1S3734",
    "D1S1162"        => "D1S1162",
    "D1S3733"        => "D1S3733",
    "D1GATA133A08"   => "GATA133A08",
    "D1S1600"        => "D1S1600",
    "D1S1679"        => "D1S1679",
    "D1S1677"        => "D1S1677",
    "D1S518"         => "D1S518",
    "D1S1667"        => "D1S1667",
    "D1S1656"        => "D1S1656",
    "D1S1171"        => "D1S1171",
    "D2TPOX"         => "TPOX",
    "D2S2952"        => "D2S2952",
    "D2S1360"        => "D2S1360",
    "D2S405"         => "D2S405",
    "D2S441"         => "D2S441",
    "D2S2970"        => "D2S2970",
    "D2S1379"        => "D2S1379",
    "D2S1776"        => "D2S1776",
    "D2S426"         => "D2S426",
    "D2S1338"        => "D2S1338",
    "D2S424"         => "D2S424",
    "D2S1363"        => "D2S1363",
    "D2S427"         => "D2S427",
    "D3S2432"        => "D3S2432",
    "D3S1768"        => "D3S1768",
    "D3S1358"        => "D3S1358",
    "D3S2452"        => "D3S2452",
    "D3S2388"        => "D3S2388",
    "D3S4529"        => "D3S4529",
    "D3S3045"        => "D3S3045",
    "D3S1744"        => "D3S1744",
    "D3S3053"        => "D3S3053",
    "D3S3041"        => "D3S3041",
    "D4S2366"        => "D4S2366",
    "D4S2408"        => "D4S2408",
    "D4S2632"        => "D4S2632",
    "D4S3251"        => "D4S3251",
    "D4S2404"        => "D4S2404",
    "D4S2364"        => "D4S2364",
    "D4S1628"        => "D4S1628",
    "D4S2634"        => "D4S2634",
    "D4S3250"        => "D4S3250",
    "D4S1644"        => "D4S1644",
    "D4FGA"          => "FGA",
    "D4S1629"        => "D4S1629",
    "D4S2368"        => "D4S2368",
    "D5S1492"        => "D5S1492",
    "D5S2845"        => "D5S2845",
    "D5S2856"        => "D5S2856",
    "D5S1457"        => "D5S1457",
    "D5S2500"        => "D5S2500",
    "D5S1474"        => "D5S1474",
    "D5S2499"        => "D5S2499",
    "D5S818"         => "D5S818",
    "D5CSF1PO"       => "CSF1PO",
    "D5S820"         => "D5S820",
    "D5S1471"        => "D5S1471",
    "D6S477"         => "D6S477",
    "D6S2439"        => "D6S2439",
    "D6S1017"        => "D6S1017",
    "D6S1960"        => "D6S1960",
    "D6S1275"        => "D6S1275",
    "D6S1052"        => "D6S1052",
    "D6S1043"        => "D6S1043",
    "D6S474"         => "D6S474",
    "D6S2409"        => "D6S2409",
    "D6S2436"        => "D6S2436",
    "D6S1027"        => "D6S1027",
    "D7S2201"        => "D7S2201",
    "D7S3047"        => "D7S3047",
    "D7S3048"        => "D7S3048",
    "D7S1821"        => "D7S1821",
    "D7S817"         => "D7S817",
    "D7S1818"        => "D7S1818",
    "D7S3069"        => "D7S3069",
    "D7S820"         => "D7S820",
    "D7S1820"        => "D7S1820",
    "D7S1799"        => "D7S1799",
    "D7S3052"        => "D7S3052",
    "D7S3054"        => "D7S3054",
    "D7S3070"        => "D7S3070",
    "D8S1106"        => "D8S1106",
    "D8S1145"        => "D8S1145",
    "D8S1477"        => "D8S1477",
    "D8S1104"        => "D8S1104",
    "D8S2332"        => "D8S2332",
    "D8S1105"        => "D8S1105",
    "D8GAAT1A4"      => "GAAT1A4",
    "D8S1132"        => "D8S1132",
    "D8S592"         => "D8S592",
    "D8S1179"        => "D8S1179",
    "D9S2169"        => "D9S2169",
    "D9S2156"        => "D9S2156",
    "D9S921"         => "D9S921",
    "D9S1121"        => "D9S1121",
    "D9S2154"        => "D9S2154",
    "D9S319"         => "D9S319",
    "D9S1118"        => "D9S1118",
    "D9S304"         => "D9S304",
    "D9S2148"        => "D9S2148",
    "D9S1122"        => "D9S1122",
    "D9S2128"        => "D9S2128",
    "D9S2145"        => "D9S2145",
    "D10S1435"       => "D10S1435",
    "D10S1430"       => "D10S1430",
    "D10S2474"       => "D10S2474",
    "D10S1426"       => "D10S1426",
    "D10S1428"       => "D10S1428",
    "D10S1432"       => "D10S1432",
    "D10S2327"       => "D10S2327",
    "D10S1246"       => "D10S1246",
    "D10S1425"       => "D10S1425",
    "D10S1248"       => "D10S1248",
    "D10S2325"       => "D10S2325",
    "D11TH01"        => "TH01",
    "D11S1999"       => "D11S1999",
    "D11S1981"       => "D11S1981",
    "D11S2368"       => "D11S2368",
    "D11S2364"       => "D11S2364",
    "D11S1392"       => "D11S1392",
    "D11S1393"       => "D11S1393",
    "D11S2363"       => "D11S2363",
    "D11S4960"       => "D11S4960",
    "D11S1367"       => "D11S1367",
    "D11S4951"       => "D11S4951",
    "D11S1998"       => "D11S1998",
    "D11S4463"       => "D11S4463",
    "D12S374"        => "D12S374",
    "D12vWA"         => "vWA",
    "D12S391"        => "D12S391",
    "D12S1057"       => "D12S1057",
    "D12S2080"       => "D12S2080",
    "D12S1301"       => "D12S1301",
    "D12S1056"       => "D12S1056",
    "D12S375"        => "D12S375",
    "D12S1297"       => "D12S1297",
    "D12S1064"       => "D12S1064",
    "D12S1030"       => "D12S1030",
    "D12S1023"       => "D12S1023",
    "D12S378"        => "D12S378",
    "D13S243"        => "D13S243",
    "D13S1493"       => "D13S1493",
    "D13S325"        => "D13S325",
    "D13S1492"       => "D13S1492",
    "D13S801"        => "D13S801",
    "D13S1824"       => "D13S1824",
    "D13S792"        => "D13S792",
    "D13S317"        => "D13S317",
    "D13S790"        => "D13S790",
    "D13S793"        => "D13S793",
    "D13S796"        => "D13S796",
    "D14S742"        => "D14S742",
    "D14S1280"       => "D14S1280",
    "D14S608"        => "D14S608",
    "D14S741"        => "D14S741",
    "D14S1432"       => "D14S1432",
    "D14S748"        => "D14S748",
    "D14S747"        => "D14S747",
    "D14S745"        => "D14S745",
    "D14S125"        => "D14S125",
    "D14S588"        => "D14S588",
    "D14S126"        => "D14S126",
    "D14S1434"       => "D14S1434",
    "D14S1426"       => "D14S1426",
    "D15S817"        => "D15S817",
    "D15S1513"       => "D15S1513",
    "D15S822"        => "D15S822",
    "D15S1232"       => "D15S1232",
    "D15S659"        => "D15S659",
    "D15GATA153F11"  => "GATA153F11",
    "D15S1507"       => "D15S1507",
    "D15S1514"       => "D15S1514",
    "D15PentaE"      => "PentaE",
    "D15S642"        => "D15S642",
    "D16S2622"       => "D16S2622",
    "D16S2619"       => "D16S2619",
    "D16S769"        => "D16S769",
    "D16S3396"       => "D16S3396",
    "D16S3253"       => "D16S3253",
    "D16S3393"       => "D16S3393",
    "D16S752"        => "D16S752",
    "D16S2624"       => "D16S2624",
    "D16S2625"       => "D16S2625",
    "D16S539"        => "D16S539",
    "D17GATA158H04"  => "GATA158H04",
    "D17S974"        => "D17S974",
    "D17AC001348A"   => "AC001348A",
    "D17S2196"       => "D17S2196",
    "D17S1294"       => "D17S1294",
    "D17S1299"       => "D17S1299",
    "D17S1290"       => "D17S1290",
    "D17S2182"       => "D17S2182",
    "D17S1535"       => "D17S1535",
    "D17S1301"       => "D17S1301",
    "D18S976"        => "D18S976",
    "D18S869"        => "D18S869",
    "D18S866"        => "D18S866",
    "D18S536"        => "D18S536",
    "D18S535"        => "D18S535",
    "D18S972"        => "D18S972",
    "D18S548"        => "D18S548",
    "D18S51"         => "D18S51",
    "D18S1367"       => "D18S1367",
    "D18S1358"       => "D18S1358",
    "D18S870"        => "D18S870",
    "D19S591"        => "D19S591",
    "D19S1165"       => "D19S1165",
    "D19S253"        => "D19S253",
    "D19S593"        => "D19S593",
    "D19S1036"       => "D19S1036",
    "D19S433"        => "D19S433",
    "D19S1170"       => "D19S1170",
    "D19S719"        => "D19S719",
    "D19S400"        => "D19S400",
    "D20S604"        => "D20S604",
    "D20S161"        => "D20S161",
    "D20S1145"       => "D20S1145",
    "D20S607"        => "D20S607",
    "D20S481"        => "D20S481",
    "D20S480"        => "D20S480",
    "D20S469"        => "D20S469",
    "D20S430"        => "D20S430",
    "D20S482"        => "D20S482",
    "D21S1432"       => "D21S1432",
    "D21S1437"       => "D21S1437",
    "D21S1409"       => "D21S1409",
    "D21S1435"       => "D21S1435",
    "D21S1442"       => "D21S1442",
    "D21S226"        => "D21S226",
    "D21S1413"       => "D21S1413",
    "D21PentaD"      => "PentaD",
    "D21S1446"       => "D21S1446",
    "D22-GATA198B05" => "D22-GATA198B05",
    "D22S686"        => "D22S686",
    "D22S533"        => "D22S533",
    "D22S691"        => "D22S691",
    "D22S1265"       => "D22S1265",
    "D22S692"        => "D22S692",
    "D22S1045"       => "D22S1045",
    "D22S534"        => "D22S534",
    "D22S444"        => "D22S444",
    "DXS6807"        => "DXS6807",
    "DXS9895"        => "DXS9895",
    "DXS8378"        => "DXS8378",
    "DXS9902"        => "DXS9902",
    "DXS6810"        => "DXS6810",
    "DXS7132"        => "DXS7132",
    "DXS10075"       => "DXS10075",
    "DXS6803"        => "DXS6803",
    "DXS9898"        => "DXS9898",
    "DXS6789"        => "DXS6789",
    "DXS7133"        => "DXS7133",
    "DXGATA172D05"   => "GATA172D05",
    "DXS7130"        => "DXS7130",
    "DXGATA165B12"   => "GATA165B12",
    "DXHPRTB"        => "HPRTB",
    "DXS7423"        => "DXS7423",
    "DYS393"         => "DYS393",
    "DYS446"         => "DYS446",
    "DYS456"         => "DYS456",
    "DYS570"         => "DYS570",
    "DYS576"         => "DYS576",
    "DYS522"         => "DYS522",
    "DYS443"         => "DYS443",
    "DYS458"         => "DYS458",
    "DYS391"         => "DYS391",
    "DYS635"         => "DYS635",
    "DYS439"         => "DYS439",
    "DYS438"         => "DYS438",
    "DYS641"         => "DYS641",
    "DYS643"         => "DYS643",
    "DYS513"         => "DYS513",
    "DYS533"         => "DYS533",
    "DYGATAA10"      => "Y-GATA-A10",
    "DYGATAH4"       => "Y-GATA-H4",
    "DYS461"         => "DYS461",
    "DYS460"         => "DYS460",
    "DYS445"         => "DYS445",
    "D1S1597"        => "D1S1597",
    "D1S3669"        => "D1S3669",
    "D1S1676"        => "D1S1676",
    "D1S3467"        => "D1S3467",
    "D1S551"         => "D1S551",
    "D1S1588"        => "D1S1588",
    "D1S1631"        => "D1S1631",
    "D1S534"         => "D1S534",
    "D1S1595"        => "D1S1595",
    "D1S1653"        => "D1S1653",
    "D1S1165"        => "D1S1165",
    "D1S1589"        => "D1S1589",
    "D1S1678"        => "D1S1678",
    "D1S2141"        => "D1S2141",
    "D1S549"         => "D1S549",
    "D1S1644"        => "D1S1644",
    "D1S517"         => "D1S517",
    "D1S1609"        => "D1S1609",
    "D2S1394"        => "D2S1394",
    "D2S1387"        => "D2S1387",
    "D2S274"         => "D2S274",
    "D2S436"         => "D2S436",
    "D2S410"         => "D2S410",
    "D2S437"         => "D2S437",
    "D2S1399"        => "D2S1399",
    "D2S1353"        => "D2S1353",
    "D2S434"         => "D2S434",
    "D2S2968"        => "D2S2968",
    "D3S3050"        => "D3S3050",
    "D3S2431"        => "D3S2431",
    "D3S4547"        => "D3S4547",
    "D3S2384"        => "D3S2384",
    "D3S1766"        => "D3S1766",
    "D3S2454"        => "D3S2454",
    "D3S2459"        => "D3S2459",
    "D3S2460"        => "D3S2460",
    "D3S1764"        => "D3S1764",
    "D3S1763"        => "D3S1763",
    "D3S2418"        => "D3S2418",
    "D4S2397"        => "D4S2397",
    "D4S1627"        => "D4S1627",
    "D4S3254"        => "D4S3254",
    "D4S3248"        => "D4S3248",
    "D4S1647"        => "D4S1647",
    "D4S2417"        => "D4S2417",
    "D4S2390"        => "D4S2390",
    "D5S2488"        => "D5S2488",
    "D5S807"         => "D5S807",
    "D5S1486"        => "D5S1486",
    "D5S1470"        => "D5S1470",
    "D5S2507"        => "D5S2507",
    "D5S806"         => "D5S806",
    "D5S1459"        => "D5S1459",
    "D5S2501"        => "D5S2501",
    "D5S1484"        => "D5S1484",
    "D5S816"         => "D5S816",
    "D5S1480"        => "D5S1480",
    "D5S1456"        => "D5S1456",
    "D6S1279"        => "D6S1279",
    "D6S1266"        => "D6S1266",
    "D6S1281"        => "D6S1281",
    "D6S1053"        => "D6S1053",
    "D6S1031"        => "D6S1031",
    "D6S1021"        => "D6S1021",
    "D6S1040"        => "D6S1040",
    "D6S1009"        => "D6S1009",
    "D6G15833"       => "G15833",
    "D6S1035"        => "D6S1035",
    "D6S1277"        => "D6S1277",
    "D7S3051"        => "D7S3051",
    "D7S3053"        => "D7S3053",
    "D7S1813"        => "D7S1813",
    "D7S1817"        => "D7S1817",
    "D7S1824"        => "D7S1824",
    "D7S1823"        => "D7S1823",
    "D8S1458"        => "D8S1458",
    "D8S1116"        => "D8S1116",
    "D8S593"         => "D8S593",
    "D8S2324"        => "D8S2324",
    "D8S1119"        => "D8S1119",
    "D8RH28094"      => "RH28094",
    "D8S1471"        => "D8S1471",
    "D8S1128"        => "D8S1128",
    "D8S1100"        => "D8S1100",
    "D8S373"         => "D8S373",
    "D9S922"         => "D9S922",
    "D9S253"         => "D9S253",
    "D9S2157"        => "D9S2157",
    "D10S1423"       => "D10S1423",
    "D10S2481"       => "D10S2481",
    "D10S1208"       => "D10S1208",
    "D10S1221"       => "D10S1221",
    "D10S1427"       => "D10S1427",
    "D10S1239"       => "D10S1239",
    "D10S1230"       => "D10S1230",
    "D10S2322"       => "D10S2322",
    "D11S2362"       => "D11S2362",
    "D11S1997"       => "D11S1997",
    "D11S4465"       => "D11S4465",
    "D11S2002"       => "D11S2002",
    "D11S4952"       => "D11S4952",
    "D11S2000"       => "D11S2000",
    "D11S4464"       => "D11S4464",
    "D11S2367"       => "D11S2367",
    "D12S1042"       => "D12S1042",
    "D12S390"        => "D12S390",
    "D12S1072"       => "D12S1072",
    "D12S1300"       => "D12S1300",
    "D12S395"        => "D12S395",
    "D12S2078"       => "D12S2078",
    "D13S800"        => "D13S800",
    "D13S779"        => "D13S779",
    "D14S121"        => "D14S121",
    "D14S592"        => "D14S592",
    "D14S617"        => "D14S617",
    "D15S643"        => "D15S643",
    "D15S818"        => "D15S818",
    "D15S652"        => "D15S652",
    "D15S816"        => "D15S816",
    "D15S1515"       => "D15S1515",
    "D16S748"        => "D16S748",
    "D16S771"        => "D16S771",
    "D16S2620"       => "D16S2620",
    "D16S2621"       => "D16S2621",
    "D17G10693"      => "G10693",
    "D17S1303"       => "D17S1303",
    "D17S2193"       => "D17S2193",
    "D17S968"        => "D17S968",
    "D18S1370"       => "D18S1370",
    "D18S973"        => "D18S973",
    "D18S843"        => "D18S843",
    "D18S542"        => "D18S542",
    "D18S877"        => "D18S877",
    "D18S847"        => "D18S847",
    "D18S978"        => "D18S978",
    "D18S851"        => "D18S851",
    "D18S858"        => "D18S858",
    "D18S1364"       => "D18S1364",
    "D18S1371"       => "D18S1371",
    "D20S473"        => "D20S473",
    "D20S603"        => "D20S603",
    "D20S162"        => "D20S162",
    "D20S1085"       => "D20S1085",
    "D20S468"        => "D20S468",
    "D20S1082"       => "D20S1082",
    "D22S685"        => "D22S685",
    "D22S417"        => "D22S417",
);

my $line_count = 0;
my $snp_ms     = 0;
my $snp_f      = 0;
my @result;
my $line;
my $num      = -1;
my @mom_type = "";
my @son_type = "";
my @dad_rate = "";
my %hashson;
my %hashdad;
my %hashmom;
my %hash_mtype;
my $head = <IN>;
print "$head";

while (<IN>) {
    chomp;
    $line = $_;

    if ( substr( $line, 0, 2 ) ne "##" ) {
        $line_count++;
        my @line = split /\t/, $line;
        push @line, 0;
        my @mom = split /\;/, $line[$mom];
        if ( $line_count >= 1 ) {

            #my @mom_var=split/\,/,$mom[3];
            foreach $each_mom (@mom) {
                if ( $line[$mom] eq 'NA' or $line[$mom] eq "" ) {
                    $sum_mom = 0;
                }
                else {
                    my @mom_var = split /\|/, $each_mom;
                    $hashmom{ $mom_var[0] } = $mom_var[1];

                    #print $mom_var[1]."\n";
                    $sum_mom += $mom_var[1];
                }
            }

            #$mom_var=$each_mom/$mom[2];
            # print $mom_var."\n";
            #push @mom_rate,$mom
            if ( $sum_mom > 1000 ) {
                foreach $mom_type ( keys %hashmom ) {
                    $mom_type_rate =
                      sprintf( "%.2f", $hashmom{$mom_type} / $sum_mom );
                    @sum_type = split( /\D+/, $mom_type );

                    #print "@sum_type"."\n";
                    #foreach $sum_type1(@sum_type){
                    #        $sum_type+=$sum_type1;
                    #}
                    if ( $mom_type_rate > 0.1 ) {
                        my $mom_type1 = $mom_type;
                        @sum_from_dad = split( /\D+/, $mom_type1 );
                        foreach (@sum_from_dad) {
                            $son_from_dad_type += $_;
                        }
                        $STR_s1 = $mom_type1;
                        $STR_s1 =~ s/\([A-Z]+\)//g;
                        $STR_s1 =~ s/[0-9]+//g;
                        if ( length($STR_s1) > 0 ) {
                            $son_from_dad_type += int( length($STR_s1) / 4 );
                            $type_last =
                              $son_from_dad_type . '.' . length($STR_s1) % 4;
                        }

                        else {
                            #print "$type\n";
                            $type_last = $son_from_dad_type;
                        }
                        $son_from_dad_type = 0;
                        push @mom_type, $type_last;

                        #print $son_from_mom;
                    }
                }
                shift @mom_type;
                $mom_num = @mom_type;
                my $momtype = join( "\/", @mom_type );
                if ( $mom_num == 1 ) {
                    print "$len{$line[0]}\t" . $momtype . '/' . $momtype . "\n";
                }
                if ( $mom_num == 2 ) {
                    $momtype = join( "\/", @mom_type );
                    print "$len{$line[0]}\t$momtype\n";
                }
                if ( $mom_num >= 3 ) {
                    print "$len{$line[0]}\tF\n";
                }
                elsif ( $mom_num == 0 ) {
                    print "$len{$line[0]}\tF\n";
                }

            }
            else {
                print "$len{$line[0]}\tNA\n";
            }
            %hashmom  = "";
            $sum_mom  = 0;
            @mom_type = "";
        }
    }
}
